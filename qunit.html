<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Slideshow - QUnit Test 0.3</title>
	<link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.17.1.css">
	<style>
		.wrapper {
			margin: 0 auto;
			max-width: 900px;
			overflow: hidden;
		}
	</style>
</head>
<body>
<div class="wrapper">
	<div id="qunit"></div>
	<div id="qunit-fixture"></div>
</div>



<!-- BEGIN SCRIPTS -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="http://code.jquery.com/qunit/qunit-1.17.1.js"></script>
<script src="jquery.slideshow.js"></script>
<script>
	
	
	
	// INIT DATA
	// ==================================================
	
	var Fixture = $('#qunit-fixture');
	var pluginName = 'slideshow';
	
	QUnit.assert.allInstancesOfjQuery = function( objects, message ) {
		
		var result = true;
		var actual = 'jQuery';
		var expected = 'jQuery';
		
		$.each( objects, function(i,object){
			if( !( object instanceof jQuery ) ) {
				result = false;
				actual = typeof object;
				return false;
			}
		});
		
		this.push( result, actual, expected, message );
	}
	QUnit.assert.allEqualTo = function( objects, expected, message ) {
		
		var result = true;
		var actual = expected;
		
		$.each( objects, function(i,object){
			if( object !== expected ) {
				result = false;
				actual = object;
				return false;
			}
		});
		
		this.push( result, actual, expected, message );
	}
	
	
	
	// INITIALIZING
	// ==================================================
	
	QUnit.module( "Initializing" );
	
	
	// Getting API
	// --------------------------------------------------
	QUnit.test( 'Getting API', function( assert ) {
		
		// Create objects
		$('<div id="test1">').appendTo( Fixture );
		$('<div id="test2">').appendTo( Fixture );
		$('<div id="test3">').appendTo( Fixture );
		
		// Call function
		var validAPI1 = $[pluginName]( '#test1' );
		var validAPI2 = new $[pluginName]( '#test2' );
		var validJQuery = $( '#test3' )[pluginName]();
		var validAPI3 = validJQuery.data( pluginName );
		
		var invalidAPI1 = $[pluginName]( 'invalid' );
		var invalidAPI2 = new $[pluginName]( 'invalid' );
		var invalidJQuery = $( 'invalid' )[pluginName]();
		var invalidAPI3 = invalidJQuery.data( pluginName );
		
		// Test
		assert.ok(
			(
				validAPI1 instanceof jQuery[pluginName] &&
				validAPI2 instanceof jQuery[pluginName] &&
				invalidAPI1 instanceof jQuery[pluginName] &&
				invalidAPI2 instanceof jQuery[pluginName]
			),
			'$.'+pluginName+'("") and new $.'+pluginName+'("") always return an API object (even if selector is not valid)'
		);
		assert.ok(
			(
				validJQuery instanceof jQuery &&
				invalidJQuery instanceof jQuery
			),
			'$("").'+pluginName+'() always returns a jQuery object (even if selector is not valid)'
		);
		assert.ok(
			validAPI3 instanceof jQuery[pluginName],
			'$("").data( "'+pluginName+'" ) returns API object ONLY if selector was valid'
		);
		assert.strictEqual(
			invalidAPI3,
			null,
			'$("").data( "'+pluginName+'" ) returns null if selector was not valid'
		);
	});
	
	
	// Multiple Instantiations
	// --------------------------------------------------
	QUnit.test( 'Multiple Instantiations', function( assert ) {
		
		// Create objects
		$('<div id="test1">').appendTo( Fixture );
		$('<div id="test2">').appendTo( Fixture );
		$('<div id="test3">').appendTo( Fixture );
		
		// Call function
		var API1 = new $[pluginName]( '#test1' );
		var API2 = $[pluginName]( '#test2' );
		var API3 = $( '#test3' )[pluginName]().data( pluginName );
		
		// Test
		assert.ok(
			(
				new $[pluginName]( 'invalid' ) !== new $[pluginName]( 'invalid' ) &&
				$[pluginName]( 'invalid' ) !== $[pluginName]( 'invalid' ) &&
				new $[pluginName]( 'invalid' ) !== $[pluginName]( 'invalid' )
			),
			'$.'+pluginName+'("") and new $.'+pluginName+'("") with invalid selectors always return a new API object'
		);
		assert.ok(
			true,
			'$("").'+pluginName+'() with invalid selector needs no testing, since it never creates an API'
		);
		assert.ok(
			(
				API1 === new $[pluginName]( '#test1' ) &&
				API1 === $[pluginName]( '#test1' ) &&
				API1 === $( '#test1' )[pluginName]().data( pluginName ) &&
				
				API2 === new $[pluginName]( '#test2' ) &&
				API2 === $[pluginName]( '#test2' ) &&
				API2 === $( '#test2' )[pluginName]().data( pluginName ) &&
				
				API3 === new $[pluginName]( '#test3' ) &&
				API3 === $[pluginName]( '#test3' ) &&
				API3 === $( '#test3' )[pluginName]().data( pluginName )
			),
			'Any type of call with a valid selector, always returns the first API created'
		);
	});
	
	
	// Multiple Elements
	// --------------------------------------------------
	QUnit.test( 'Multiple Elements', function( assert ) {
		
		// Create objects
		$('<div id="call2A">').appendTo( Fixture );
		$('<div id="call2B">').appendTo( Fixture );
		$('<div id="jquery2A">').appendTo( Fixture );
		$('<div id="jquery2B">').appendTo( Fixture );
		
		// Get elements
		var API1 = $[pluginName]( '#call2A, #call2B' );
		$( '#jquery2A, #jquery2B' )[pluginName]();
		
		// Test
		assert.ok(
			(
				$('#call2A').data( pluginName ) instanceof jQuery[pluginName] &&
				typeof $('#call2B').data( pluginName ) === 'undefined'
			),
			"On $."+pluginName+"('multiple') calls, only the first element has API"
		);
		assert.ok(
			(
				$('#jquery2A').data( pluginName ) instanceof jQuery[pluginName] &&
				$('#jquery2B').data( pluginName ) instanceof jQuery[pluginName] &&
				$('#jquery2A').data( pluginName ) !== $('#jquery2B').data( pluginName )
			),
			"On $('multiple')."+pluginName+"(), each element has its own independent API"
		);
		
		// Another test
		$( '#call2A, #call2B' )[pluginName]();
		assert.ok(
			(
				$('#call2A').data( pluginName ) === API1 &&
				$('#call2B').data( pluginName ) instanceof jQuery[pluginName]
			),
			"$('multiple')."+pluginName+"() reuses existing APIs, or creates new ones if they don't exist"
		);
		
	});
	
	
	// API.element
	// --------------------------------------------------
	QUnit.test( 'API.element', function( assert ) {
		
		// Create objects
		$('<div id="call1">').appendTo( Fixture );
		$('<div id="call2A">').appendTo( Fixture );
		$('<div id="call2B">').appendTo( Fixture );
		$('<div id="jquery1">').appendTo( Fixture );
		$('<div id="jquery2A">').appendTo( Fixture );
		$('<div id="jquery2B">').appendTo( Fixture );
		
		// Get elements
		var Invalid = $[pluginName]( 'invalid' ).element;
		var Call1 = $[pluginName]( '#call1' ).element;
		var Call2 = $[pluginName]( '#call2A, #call2B' ).element;
		var jQuery1 = $( '#jquery1' )[pluginName]().data( pluginName ).element;
		var jQuery2 = $( '#jquery2A, #jquery2B' )[pluginName]().data( pluginName ).element;
		
		// Test
		assert.allInstancesOfjQuery(
			[ Invalid, Call1, Call2, jQuery1, jQuery2 ],
			'Is always jQuery (even if no valid selector was used)'
		);
		assert.strictEqual(
			Invalid.length,
			0,
			'.length == 0 for $.'+pluginName+'( "invalid" ) calls'
		);
		assert.allEqualTo(
			[ Call1.length, Call2.length, jQuery1.length, jQuery2.length ],
			1,
			'.length == 1 for ALL valid calls (even if selector matched many elements)'
		);
	});
	
	
	// API.settings
	// --------------------------------------------------
	QUnit.test( 'API.settings', function( assert ) {
		
		// --- Test type of variable
		$('<div id="call">').appendTo( Fixture );
		$('<div id="jquery">').appendTo( Fixture );
		var API0 = $[pluginName]( 'invalid' );
		var API1 = $[pluginName]( '#call' );
		var API2 = $( '#jquery' )[pluginName]().data( pluginName );
		assert.ok(
			(
				typeof API0.settings == 'object' &&
				typeof API1.settings == 'object' &&
				typeof API2.settings == 'object'
			),
			'Is always an object (even if no valid selector was used)'
		);
		
		// --- Test Changing Defaults
		$[pluginName].prototype.defaults({ loremipsum:1 });
		var Defaults1 = $[pluginName]( 'invalid' );
		$[pluginName].prototype.defaults({ loremipsum:2 });
		var Defaults2 = $[pluginName]( 'invalid' );
		assert.ok(
			(
				Defaults1.settings.loremipsum === 1 &&
				Defaults2.settings.loremipsum === 2
			),
			'Can change default settings by calling $.'+pluginName+'.prototype.defaults()'
		);
		
		// --- Test settings overriding
		$('<div id="overrides" data-'+pluginName+'-settings=\'{"loremipsum":4}\'>').appendTo( Fixture );
		var Overrides1 = $[pluginName]( '',{ loremipsum:3 });
		var Overrides2 = $[pluginName]( '#overrides',{ loremipsum:3 });
		assert.strictEqual(
			Overrides1.settings.loremipsum,
			3,
			'"settings" argument overrides defaults'
		);
		assert.strictEqual(
			Overrides2.settings.loremipsum,
			4,
			'"data-'+pluginName+'-settings" attribute overrides settings'
		);
		
	});
	
	
	// API.init() and API.destroy()
	// --------------------------------------------------
	QUnit.test( 'API.init() and API.destroy()', function( assert ) {
		
		// --- Test init()
		$('<div id="test1">').appendTo( Fixture );
		var API = $[pluginName]( '#test1',{ dolorsit:123 });
		API.init({ loremipsum:'xxx' });
		assert.notStrictEqual(
			API.settings.loremipsum,
			'xxx',
			'Can\'t call .init() on objects already initialized'
		);
		
		// --- Test destroy()
		API.destroy();
		assert.ok(
			(
				$('#test1').data( pluginName ) === undefined &&
				API.element[0] === $('#test1')[0] &&
				API.settings.dolorsit === 123
			),
			'Calling .destroy() detaches API from element, but keeps element and settings in API'
		);
		
		// --- Test init() after destroy()
		API.init({ loremipsum:'yyy' });
		assert.strictEqual(
			API.settings.loremipsum,
			'yyy',
			'You can call .init( newSettings ) again after destroy(), and you can override settings by passing an object'
		);
		
		// --- Chain functions
		API.destroy().destroy().init();
		assert.ok(
			true,
			'Both functions are chainable'
		);
	});
	
	
	
	
	
	// BASICS
	// ==================================================
	
	QUnit.module( "Basics" );
	
	
	// API.slides
	// --------------------------------------------------
	QUnit.test( 'API.slides', function( assert ) {
		
		// Create objects
		var Slider0 = $('<div id="test">').appendTo( Fixture );
		var Slider1 = $('<div id="test1">').appendTo( Fixture ).append( '<div class="slide"></div>' );
		var Slider2 = $('<div id="test2">').appendTo( Fixture ).append( '<div class="slideX"></div><div class="slideX"></div>' );
		
		var APIX = $[ pluginName ]( 'invalid' );
		var API0 = Slider0[ pluginName ]().data( pluginName );
		var API1 = Slider1[ pluginName ]().data( pluginName );
		var API2 = Slider2[ pluginName ]({ slides:'.slideX' }).data( pluginName );
		
		// Test
		assert.allInstancesOfjQuery(
			[ APIX.slides, API0.slides, API1.slides, API2.slides ],
			'All APIs must have a "slides" jQuery object'
		);
		assert.strictEqual(
			API2.slides.length,
			2,
			'Slides should be selected based on the "slides" setting'
		);
		assert.ok(
			(
				APIX.slides.length === 0 &&
				API0.slides.length === 0 &&
				API1.slides.length === 1 &&
				API2.slides.length === 2
			),
			'API.slides should include all matching slides'
		);
		
		// .destroy()
		API2.destroy();
		assert.strictEqual(
			API2.slides,
			undefined,
			'API.slides must be removed on .destroy()'
		);
		
		// Stop init()
		console.warn( 'PENDING!!!: API.slides: stop init() function if there\'s less than 2 slides' );
	});
	
	
	// API.data (basics)
	// --------------------------------------------------
	QUnit.test( 'API.data (basics)', function( assert ) {
		
		// Create objects
		var Slider = $('<div id="test">').appendTo( Fixture ).append( '<div class="slide"></div><div class="slide"></div>' );
		var API = Slider[ pluginName ]().data( pluginName );
		
		// Test
		assert.strictEqual(
			typeof API.data,
			'object',
			'All APIs must have a "data" object'
		);
		assert.ok(
			(
				API.data.hasOwnProperty( 'total' ) &&
				API.data.hasOwnProperty( 'current' ) &&
				API.data.hasOwnProperty( 'previous' )
			),
			'"total", "current" and "previous" must exist'
		);
		
		// .destroy()
		API.destroy();
		assert.strictEqual(
			API.data,
			undefined,
			'API.data must be removed on .destroy()'
		);
		
	});
	
	
	// API.showSlide()
	// --------------------------------------------------
	QUnit.test( 'API.showSlide()', function( assert ) {
		
		// Create objects
		var Slider = $('<div>').appendTo( Fixture ).append( '<div class="slide"></div><div class="slide"></div><div class="slide"></div>' );
		var Slides = Slider.find( '.slide' );
		var Slide1 = Slides.eq(0);
		var Slide2 = Slides.eq(1);
		var Slide3 = Slides.eq(2);
		var API = Slider[ pluginName ]().data( pluginName );
		
		
		// First slide is already running
		assert.notStrictEqual(
			API.data.current,
			undefined,
			'Automatically show slide selected in "showFirst"'
		);
		
		var done0 = assert.async();
		function test0(){
			
			// Function is available
			assert.equal(
				typeof API.showSlide,
				'function',
				'API.showSlide() available'
			);

			// Check required settings
			assert.ok(
				(
					API.data.hasOwnProperty( 'isChanging' ) &&
					API.data.hasOwnProperty( 'speed' ) &&
					API.data.hasOwnProperty( 'timerChange' )
				),
				'API.data: "isChanging", "speed" and "timerChange" must exist'
			);
			assert.ok(
				(
					API.settings.hasOwnProperty( 'speed' ) &&
					API.settings.hasOwnProperty( 'classSelected' ) &&
					API.settings.hasOwnProperty( 'classTransition' ) &&
					API.settings.hasOwnProperty( 'showFirst' )
				),
				'API.settings: "speed", "showFirst", "classSelected" and "classTransition" must exist'
			);

			// Test "newSlide"
			assert.throws(
				function(){ API.showSlide() },
				'"newSlide" is required and must be a number'
			);

			// Test default "speed"
			API.showSlide( 1 );
			assert.equal(
				API.data.speed,
				API.settings.speed,
				'"speed" defaults to settings.speed'
			);
			
			//
			done0();
			setTimeout( test1, API.data.speed+10 );
		}
		setTimeout( test0, API.data.speed+10 );
		
		// Test custom "speed"
		var done1 = assert.async();
		function test1(){
			API.showSlide( 2, 5 );
			assert.equal(
				API.data.speed,
				5,
				'"speed" argument is used and stored as data'
			);
			done1();
			setTimeout( test2, API.data.speed+10 );
		}
		
		// Test min limit
		var done2 = assert.async();
		function test2() {
			API.showSlide( -1, 0 );
			assert.strictEqual(
				API.data.current,
				0,
				'Limit newSlide to number of slides (min = 0)'
			);
			done2();
			setTimeout( test3, API.data.speed+10 );
		}
		
		// Test max limit
		var done3 = assert.async();
		function test3() {
			API.showSlide( 5, 100 );
			assert.strictEqual(
				API.data.current,
				2,
				'Limit newSlide to number of slides (max = total)'
			);
			
			// Cancel if "isChanging"
			API.showSlide( 0 );
			assert.notEqual(
				API.data.current,
				0,
				'Cancel function if isChanging == true'
			);
			
			done3();
			setTimeout( test4, API.data.speed+10 );
		}
		
		// Cancel if newSlide == data.current
		var done4 = assert.async();
		function test4() {
			API.showSlide( 2, 8 );
			assert.notEqual(
				API.data.speed,
				8,
				'Cancel function if slideNum == data.current'
			);
			
			// Update data.previous and current
			var oldCurrent = API.data.current;
			API.showSlide( 0, 0 );
			assert.ok(
				(
					API.data.current === 0 &&
					API.data.previous === oldCurrent
				),
				'Correctly update data.previous and data.current'
			);
			
			done4();
			setTimeout( test5, API.data.speed+10 );
		}
		
		// Update data.previous and current
		var done5 = assert.async();
		function test5() {
			
			// Before
			var isChanging1 = API.data.isChanging;
			var correctSlidesClasses1 = (
				Slide1.hasClass( API.settings.classSelected ) &&
				!Slide2.hasClass( API.settings.classSelected ) &&
				!Slide3.hasClass( API.settings.classSelected )
			);
			var correctAriaLive1 = (
				Slide1.attr( 'aria-live' ) == 'polite' &&
				!Slide2.is( '[aria-live]' ) &&
				!Slide3.is( '[aria-live]' )
			);
			var correctAriaHidden1 = (
				!Slide1.is( '[aria-hiden]' ) &&
				Slide2.attr( 'aria-hidden' ) == 'true' &&
				Slide3.attr( 'aria-hidden' ) == 'true'
			);
			var transitionClass1 = !Slider.hasClass( API.settings.classTransition );
			
			// During
			API.showSlide( 1, 100 );
			var isChanging2 = API.data.isChanging;
			var transitionClass2 = Slider.hasClass( API.settings.classTransition );
			
			// After
			setTimeout(function(){
				var isChanging3 = API.data.isChanging;
				var correctSlidesClasses2 = (
					!Slide1.hasClass( API.settings.classSelected ) &&
					Slide2.hasClass( API.settings.classSelected ) &&
					!Slide3.hasClass( API.settings.classSelected )
				);
				var correctAriaLive2 = (
					!Slide1.is( '[aria-live]' ) &&
					Slide2.attr( 'aria-live' ) == 'polite' &&
					!Slide3.is( '[aria-live]' )
				);
				var correctAriaHidden2 = (
					Slide1.attr( 'aria-hidden' ) == 'true' &&
					!Slide2.is( '[aria-hidden]' ) &&
					Slide3.attr( 'aria-hidden' ) == 'true'
				);
				
				// Test
				assert.ok(
					( !isChanging1 && isChanging2 && !isChanging3 ),
					'Correctly update data.isChanging before and after transition'
				);
				assert.ok(
					( correctSlidesClasses1 && correctSlidesClasses2 ),
					'Correctly update "selected" class on slides'
				);
				assert.ok(
					( correctAriaLive1 && correctAriaLive1 && correctAriaHidden1 && correctAriaHidden2 ),
					'Correctly update aria attributes on slides'
				);
				assert.ok(
					( transitionClass1 && transitionClass2 ),
					'Correctly update "transition" class on slider'
				);
				
				done5();
			}, API.data.speed+10 );
		}
		
		console.warn( 'PENDING!!!: API.showSlide(): test showFirst == \'random\'' );
	});
	
	
	// API.showSlide().destroy()
	// --------------------------------------------------
	QUnit.test( 'API.showSlide().destroy()', function( assert ) {
		
		// Create objects
		var Slider = $('<div>').appendTo( Fixture ).append( '<div class="slide"></div><div class="slide"></div><div class="slide"></div>' );
		var Slides = Slider.find( '.slide' );
		var Slide1 = Slides.eq(0);
		var Slide2 = Slides.eq(1);
		var Slide3 = Slides.eq(2);
		
		// Function
		function conv( variable ) {
			if( variable === '' )
				return undefined;
		}
		
		// Get initial state
		var elementClass1 = conv( Slider.attr( 'class' ) );
		var slide1Class1 = conv( Slide1.attr( 'class' ) );
		var slide2Class1 = conv( Slide2.attr( 'class' ) );
		var slide3Class1 = conv( Slide3.attr( 'class' ) );
		var slide1Live1 = conv( Slide1.attr( 'aria-live' ) );
		var slide2Live1 = conv( Slide2.attr( 'aria-live' ) );
		var slide3Live1 = conv( Slide3.attr( 'aria-live' ) );
		var slide1Hidden1 = conv( Slide1.attr( 'aria-hidden' ) );
		var slide2Hidden1 = conv( Slide2.attr( 'aria-hidden' ) );
		var slide3Hidden1 = conv( Slide3.attr( 'aria-hidden' ) );
		
		// Run plugin
		var API = Slider[ pluginName ]().data( pluginName );
		API.destroy();
		
		// Get final state
		var elementClass2 = conv( Slider.attr( 'class' ) );
		var slide1Class2 = conv( Slide1.attr( 'class' ) );
		var slide2Class2 = conv( Slide2.attr( 'class' ) );
		var slide3Class2 = conv( Slide3.attr( 'class' ) );
		var slide1Live2 = conv( Slide1.attr( 'aria-live' ) );
		var slide2Live2 = conv( Slide2.attr( 'aria-live' ) );
		var slide3Live2 = conv( Slide3.attr( 'aria-live' ) );
		var slide1Hidden2 = conv( Slide1.attr( 'aria-hidden' ) );
		var slide2Hidden2 = conv( Slide2.attr( 'aria-hidden' ) );
		var slide3Hidden2 = conv( Slide3.attr( 'aria-hidden' ) );
		
		// Test
		assert.ok(
			elementClass1 === elementClass2,
			'"class" of element is restored'
		);
		assert.ok(
			(
				slide1Class1 === slide1Class2 &&
				slide2Class1 === slide2Class2 &&
				slide3Class1 === slide3Class2
			),
			'"class" of slides is restored'
		);
		assert.ok(
			(
				slide1Live1 === slide1Live2 &&
				slide2Live1 === slide2Live2 &&
				slide3Live1 === slide3Live2
			),
			'"aria-live" attribute of slides is restored'
		);
		assert.ok(
			(
				slide1Hidden1 === slide1Hidden2 &&
				slide2Hidden1 === slide2Hidden2 &&
				slide3Hidden1 === slide3Hidden2
			),
			'"aria-hidden" attribute of slides is restored'
		);
		assert.strictEqual(
			API.showSlide,
			undefined,
			'API.showSlide() must be removed on .destroy()'
		);
		
		console.warn( 'PENDING!!!: slideshow().destroy(): Early execution of timerChangeF' );
		
	});
	
	
	// API.showPrevious() and API.showNext()
	// --------------------------------------------------
	QUnit.test( 'API.showPrevious() and API.showNext()', function( assert ) {
		
		var Slider = $('<div>').appendTo( Fixture ).append( '<div class="slide"></div><div class="slide"></div><div class="slide"></div>' );
		var API = Slider[ pluginName ]({ keyboard:false }).data( pluginName );
		
		// Test showNext
		var current1 = API.data.current;
		var done1 = assert.async();
		function test1() {
			API.showNext().showSlide( 0 ).showNext();
			var current2 = API.data.current;
			assert.ok(
				( current1 == 0 && current2 == 1 ),
				'showNext is working and is chainable (showSlide is also chainable)'
			);
			done1();
			setTimeout( test2, API.data.speed + 10 );
		}
		setTimeout( test1, API.data.speed + 10 );
		
		// Test showPrevious
		var done2 = assert.async();
		function test2() {
			API.showPrevious().showNext().showPrevious();
			var current3 = API.data.current;
			assert.strictEqual(
				current3,
				0,
				'showPrevious is working and is chainable'
			);
			done2();
			setTimeout( test3, API.data.speed + 10 );
		}
		
		// Test with keyboard = false
		var done3 = assert.async();
		function test3() {
			$(document).trigger( $.Event( 'keydown', { keyCode: 39 } ) );
			assert.notStrictEqual(
				API.data.current,
				1,
				'keyboard events don\'t work if setting.keyboard == false'
			);
			API.destroy().init({ keyboard:true });
			done3();
			setTimeout( test4, API.data.speed + 10 );
		}
		
		// Test right arrow
		var done4 = assert.async();
		function test4() {
			$(document).trigger( $.Event( 'keydown', { keyCode: 39 } ) );
			assert.strictEqual(
				API.data.current,
				1,
				'right arrow works if setting.keyboard == true'
			);
			done4();
			setTimeout( test5, API.data.speed + 10 );
		}
		
		// Test left arrow
		var done5 = assert.async();
		function test5() {
			$(document).trigger( $.Event( 'keydown', { keyCode: 37 } ) );
			assert.strictEqual(
				API.data.current,
				0,
				'left arrow works if setting.keyboard == true'
			);
			done5();
			setTimeout( test6, API.data.speed + 10 );
		}
		
		// Remove event handler on destroy
		var done6 = assert.async();
		function test6() {
			var handlers1 = typeof $._data( document, "events" ).keydown;
			API.destroy();
			var handlers2 = typeof $._data( document, "events" );
			
			assert.ok(
				handlers1 == 'object' && handlers2 == 'undefined',
				'keyboard event handlers removed on destroy()'
			)
			assert.ok(
				typeof API.showNext == 'undefined' && typeof API.showPrevious == 'undefined',
				'showNext and showPrevious removed on destroy()'
			);
			done6();
		}
	});
	
	
	
	
	
	// EXTRAS
	// ==================================================
	
	QUnit.module( "Extras" );
	
	
	// settings.loop
	// --------------------------------------------------
	QUnit.test( 'settings.loop', function( assert ) {
		
		var Slider = $('<div>').appendTo( Fixture ).append( '<div class="slide"></div><div class="slide"></div><div class="slide"></div>' );
		var API = Slider[ pluginName ]({ loop:true }).data( pluginName );
		
		// Test 1
		var done1 = assert.async();
		function test1() {
			API.showPrevious();
			assert.equal(
				API.data.current,
				2,
				'Looping is enabled when settings.loop == true'
			);
			API.destroy().init({ loop:false });
			done1();
			setTimeout( test2, API.data.speed + 10 );
		}
		setTimeout( test1, API.data.speed + 10 );
		
		// Test 2
		var done2 = assert.async();
		function test2() {
			API.showPrevious();
			assert.equal(
				API.data.current,
				0,
				'Looping is disabled when settings.loop == false'
			);
			done2();
		}
		
	});
	
	
	// play() and stop()
	// --------------------------------------------------
	QUnit.test( 'play() and stop()', function( assert ) {
		
		var Slider = $('<div>').appendTo( Fixture ).append( '<div class="slide"></div><div class="slide"></div><div class="slide"></div>' );
		var API = Slider[ pluginName ]({ autoplay:false, timer:1000 }).data( pluginName );
		
		assert.ok(
			(
				API.data.hasOwnProperty( 'isPlaying' ) &&
				API.data.hasOwnProperty( 'timerPlay' ) &&
				API.data.hasOwnProperty( 'timerPlayF' )
			),
			'API.data has "isPlaying", "timerPlay" and "timerPlayF"'
		);
		assert.ok(
			(
				API.settings.hasOwnProperty( 'timer' ) &&
				API.settings.hasOwnProperty( 'autoplay' ) &&
				API.settings.hasOwnProperty( 'classPlaying' )
			),
			'API.settings has "timer", "autoplay" and "classPlaying"'
		);
		
		// Test 1
		var done1 = assert.async();
		var isPlaying1 = API.data.isPlaying, isPlaying2;
		var current1, current2, current3;
		function test1() {
			current1 = API.data.current;
			API.play();
			isPlaying2 = API.data.isPlaying;
			assert.ok(
				(
					isPlaying1 === false,
					isPlaying2 === true
				),
				'play() changes data immediatly'
			);
			done1();
			setTimeout( test2, API.settings.timer - 10 );
			setTimeout( test3, API.settings.timer + 10 );
		}
		setTimeout( test1, API.data.speed + 10 );
		
		// Test 2
		var done2 = assert.async();
		function test2() {
			current2 = API.data.current;
		}
		function test3() {
			current3 = API.data.current;
			assert.ok(
				(
					current1 === current2 &&
					current3 - current2 == 1
				),
				'play() changes slide after time set in settings.timer'
			);
			done2();
			test4();
		}
		
		// Test 3
		var done4 = assert.async();
		function test4() {
			var isPlaying1 = API.data.isPlaying;
			API.stop();
			var isPlaying2 = API.data.isPlaying;
			assert.ok(
				(
					isPlaying1 != isPlaying2 &&
					API.data.timerPlayF === $.noop
				),
				'cancel() updates data and cancels timerPlay'
			);
			done4();
			test5();
		}
		
		// Test 4
		var done5 = assert.async();
		function test5() {
			API.destroy().init({ autoplay:false });
			var autoplay1 = API.settings.autoplay;
			var classname1 = Slider.hasClass( API.settings.classPlaying );
			API.destroy().init({ autoplay:true });
			var autoplay2 = API.settings.autoplay;
			var classname2 = Slider.hasClass( API.settings.classPlaying );
			assert.ok(
				(
					autoplay1 === false &&
					autoplay2 === true
				),
				'settings.autoplay works'
			);
			assert.ok(
				(
					classname1 === false &&
					classname2 === true
				),
				'settings.classPlaying works'
			);
			
			API.destroy();
			assert.ok(
				(
					!API.hasOwnProperty( 'play' ) &&
					!API.hasOwnProperty( 'stop' )
				),
				'destroy() removes play and stop'
			);
			assert.ok(
				(
					!Slider.hasClass( API.settings.classPlaying )
				),
				'destroy() removes classPlaying from element'
			);
			done5();
		}
		
	});
	
	
	// events
	// --------------------------------------------------
	QUnit.test( 'trigger events', function( assert ) {
		
		// Setup
		var Slider = $('<div>').appendTo( Fixture ).append( '<div class="slide"></div><div class="slide"></div><div class="slide"></div>' );
		var testCounter = 0;
		var eventCounter = 0;
		
		// Init
		function testEvent( name, testname, callback ) {
			var counter = ++testCounter;
			var done = assert.async();
			Slider.on( name+'.'+testname, function(){
				assert.equal(
					counter,
					++eventCounter,
					testname+': '+eventCounter+'. '+name
				);
				Slider.off( name+'.'+testname );
				done();
				if( typeof callback == 'function' )
					callback();
			});
		}
		testEvent( 'slideshowinit', 'init' );
		testEvent( 'slideshowupdate', 'init' );
		testEvent( 'slideshowchangestart', 'init' );
		testEvent( 'slideshowchangeend', 'init' );
		testEvent( 'slideshowplay', 'init', test2 );
		var API = Slider[ pluginName ]({ autoplay:true }).data( pluginName );
		
		// showSlide
		function test2() {
			testCounter = 0;
			eventCounter = 0;
			testEvent( 'slideshowupdate', 'showSlide' );
			testEvent( 'slideshowchangestart', 'showSlide' );
			testEvent( 'slideshowchangeend', 'showSlide' );
			testEvent( 'slideshowplay', 'showSlide', test3 );
			API.showSlide( 1, 0 );
		}
		
		// stop
		function test3() {
			testCounter = 0;
			eventCounter = 0;
			testEvent( 'slideshowupdate', 'stop' );
			testEvent( 'slideshowstop', 'stop', test4 );
			API.stop();
		}
		
		// stop
		function test4() {
			testCounter = 0;
			eventCounter = 0;
			testEvent( 'slideshowupdate', 'play' );
			testEvent( 'slideshowplay', 'play' );
			API.play();
		}
		
	});
	
	
	// settings.pauseOnFocus
	// --------------------------------------------------
	QUnit.test( 'settings.pauseOnFocus', function( assert ) {
		
		// Setup
		var Slider = $('<div>').appendTo( Fixture );
		var Slides = $('<div class="slide"></div><div class="slide"></div><div class="slide"></div>').appendTo( Slider );
		Slides.attr( 'tabindex', -1 );
		var API = Slider[ pluginName ]({ autoplay:true, pauseOnFocus:false }).data( pluginName );
		
		// Check
		assert.ok(
			API.settings.hasOwnProperty( 'pauseOnFocus' ),
			'settings.pauseOnFocus exists'
		);
		
		// set to false
		var isPlaying1 = API.data.isPlaying;
		Slides.first().trigger( 'focus' );
		var isPlaying2 = API.data.isPlaying;
		assert.ok(
			(
				isPlaying1 === true &&
				isPlaying2 === true
			),
			'no effect if set to false'
		);
		
		// set to false
		API.destroy().init({ pauseOnFocus:true });
		isPlaying1 = API.data.isPlaying;
		Slides.first().trigger( 'focus' );
		isPlaying2 = API.data.isPlaying;
		assert.ok(
			(
				isPlaying1 === true &&
				isPlaying2 === false
			),
			'if set to true, pauses slider when an element inside gains focus'
		);
		
	});
	
	
	// data.isChanging
	// --------------------------------------------------
	QUnit.test( 'data.isChanging', function( assert ) {
		
		// Setup
		var Slider = $('<div>').appendTo( Fixture );
		var Slides = $('<div class="slide"></div><div class="slide"></div><div class="slide"></div>').appendTo( Slider );
		var API = Slider[ pluginName ]({ autoplay:false, loop:true }).data( pluginName );
		
		// Test 1
		assert.ok(
			API.data.isChanging === 1,
			'value while showing a slide for the first time must be 1'
		);
		
		// Test 2
		API.data.timerChangeF();
		assert.ok(
			API.data.isChanging === false,
			'must be false when not changing'
		);
		
		// Test 2
		API.showSlide( 2 );
		assert.ok(
			API.data.isChanging === 1,
			'must be 1 when skipping forward'
		);
		
		// Test 3
		API.data.timerChangeF();
		API.showSlide( 0 );
		assert.ok(
			API.data.isChanging === -1,
			'must be -1 when skipping backwards'
		);
		
		// Test 4
		API.data.timerChangeF();
		API.showPrevious();
		assert.ok(
			API.data.isChanging === -1 && API.data.current == 2,
			'must always be -1 when using showPrevious (even if looping is true)'
		);
		
		// Test 5
		API.data.timerChangeF();
		API.showNext();
		assert.ok(
			API.data.isChanging === 1 && API.data.current == 0,
			'must always be 1 when using showNext (even if looping is true)'
		);
		
	});
	
	
	
	
	
	// CONTROLS
	// ==================================================
	
	QUnit.module( "Controls" );
	
	
	// Prev/Next
	// --------------------------------------------------
	QUnit.test( 'Prev/Next', function( assert ) {
		
		// Setup
		var Slider = $('<div>').appendTo( Fixture );
		var Slides = $('<div class="slide"></div><div class="slide"></div><div class="slide"></div>').appendTo( Slider );
		
		// Create Controls
		var prevText1 = 'previous';
		var nextText1 = 'next';
		var prevText2 = '111';
		var nextText2 = '222';
		var classname = 'disabledtag';
		var Prev = $('<div class="prev">').text( prevText1 ).appendTo( Slider );
		var Next = $('<div class="next">').text( nextText1 ).appendTo( Slider );
		
		// Init
		var API = Slider[ pluginName ]({
			controlsPrev: '.prev',
			controlsNext: '.next',
			textPrev: prevText2,
			textNext: nextText2,
			classDisabled: classname,
			loop: true,
			showFirst: 1,
		}).data( pluginName );
		
		// Select buttons
		var PrevBtn = Prev.children('a[role=button][href]');
		var NextBtn = Next.children('a[role=button][href]');
		
		// API.settings
		assert.ok(
			(
				API.settings.hasOwnProperty( 'controlsPrev' ) &&
				API.settings.hasOwnProperty( 'controlsNext' ) &&
				API.settings.hasOwnProperty( 'textPrev' ) &&
				API.settings.hasOwnProperty( 'textNext' ) &&
				API.settings.hasOwnProperty( 'classDisabled' )
			),
			'API.settings has controlsPrev, controlsNext, textPrev, textNext and classDisabled'
		);
		
		// Private vars
		assert.ok(
			(
				!API.settings.hasOwnProperty( 'controls' ) &&
				!API.settings.hasOwnProperty( 'createControls' ) &&
				!API.settings.hasOwnProperty( 'updateControls' )
			),
			'API.controls, API.createControls and API.updateControls should be private'
		);
		
		// Selector test
		assert.ok(
			(
				PrevBtn.length &&
				NextBtn.length
			),
			'Selectors are working, and they create a child <a> tag with role and href attributes'
		);
		
		// Text test
		assert.ok(
			(
				PrevBtn.html() === prevText2 &&
				NextBtn.html() === nextText2
			),
			'Text settings are working'
		);
		
		// Disabled status not working if loop == true
		assert.ok(
			(
				!Prev.hasClass( classname ) &&
				!PrevBtn.is( '[tabindex]' )
			),
			'Prev button doesn\'t get disabled if loop == true'
		);
		
		API.data.timerChangeF();
		API.showSlide( 2, 0 );
		assert.ok(
			(
				!Next.hasClass( classname ) &&
				!NextBtn.is( '[tabindex]' )
			),
			'Next button doesn\'t get disabled if loop == true'
		);
		
		// Disabled status works if loop == false
		API.destroy().init({ loop:false });
		PrevBtn = Prev.children('a');
		NextBtn = Next.children('a');
		assert.ok(
			(
				Prev.hasClass( classname ) &&
				PrevBtn.is( '[tabindex]' ) &&
				!Next.hasClass( classname ) &&
				!NextBtn.is( '[tabindex]' )
			),
			'Prev button is disabled on first slide when loop == false'
		);
		
		API.data.timerChangeF();
		API.showSlide( 2, 0 );
		assert.ok(
			(
				!Prev.hasClass( classname ) &&
				!PrevBtn.is( '[tabindex]' ) &&
				Next.hasClass( classname ) &&
				NextBtn.is( '[tabindex]' )
			),
			'Next button is disabled on last slide when loop == false'
		);
		
		// Action trigger
		API.data.timerChangeF();
		var current1 = API.data.current;
		PrevBtn.trigger( 'click' );
		var current2 = API.data.current;
		assert.ok(
			(
				current1 === 2 &&
				current2 === 1
			),
			'Prev button works'
		);
		
		API.data.timerChangeF();
		NextBtn.trigger( 'click' );
		var current3 = API.data.current;
		assert.ok(
			(
				current2 === 1 &&
				current3 === 2
			),
			'Next button works'
		);
		
		// Destroy
		var eventHandler1 = $._data( Slider[0], 'events' ).slideshowupdate.length;
		API.destroy();
		var eventHandler2 = $._data( Slider[0], 'events' );
		assert.ok(
			(
				eventHandler1 > 0 &&
				typeof eventHandler2 === 'undefined'
			),
			'on destroy: slideshowupdate event handler removed'
		);
		
		assert.ok(
			(
				Prev.html() === prevText1 &&
				Next.html() === nextText1
			),
			'on destroy: text is restored on both links'
		);
	});
	
	
	// Play/Stop
	// --------------------------------------------------
	QUnit.test( 'Play/Stop', function( assert ) {
		
		// Setup
		var Slider = $('<div>').appendTo( Fixture );
		var Slides = $('<div class="slide"></div><div class="slide"></div><div class="slide"></div>').appendTo( Slider );
		
		// Create Controls
		var defaultText = 'play/pause';
		var playText = 'Play';
		var stopText = 'Stahp!';
		var Play = $('<div class="play">').text( defaultText ).appendTo( Slider );
		
		// Init
		var API = Slider[ pluginName ]({
			controlsPlay: '.play',
			textPlay: playText,
			textStop: stopText,
			autoplay: false,
		}).data( pluginName );
		
		// Select button
		var PlayBtn = Play.children('a[role=button][href]');
		
		// API.settings
		assert.ok(
			(
				API.settings.hasOwnProperty( 'controlsPlay' ) &&
				API.settings.hasOwnProperty( 'textPlay' ) &&
				API.settings.hasOwnProperty( 'textStop' )
			),
			'API.settings has controlsPlay, textPlay and textStop'
		);
		
		//
		assert.ok(
			(
				PlayBtn.html() === playText
			),
			'selector and textPlay is working'
		);
		
		API.play();
		assert.ok(
			(
				PlayBtn.html() === stopText
			),
			'textStop is working'
		);
		
		// Trigger functions
		var isPlaying1 = API.data.isPlaying;
		PlayBtn.trigger( 'click' );
		var isPlaying2 = API.data.isPlaying;
		PlayBtn.trigger( 'click' );
		var isPlaying3 = API.data.isPlaying;
		assert.ok(
			(
				isPlaying1 === true &&
				isPlaying2 === false &&
				isPlaying3 === true
			),
			'Button triggers play()/stop()'
		);
		
		// Destroy
		API.destroy();
		assert.ok(
			(
				Play.html() === defaultText
			),
			'on destroy: text is restored'
		);
	});
	
	
	// Nav Items
	// --------------------------------------------------
	QUnit.test( 'Nav Items', function( assert ) {
		
		var Slider, Slides, API;
		var slideName = 'Lorem Ipsum';
		var defaultText = 'item';
		var newText1 = 'Item text {title}';
		var newText2 = 'Item text {title} selected';
		var basicsChecked = false;
		
		function setupTest( numberOfItems ) {
			
			// Setup
			Slider = $('<div>').appendTo( Fixture );
			Slides = $('<div class="slide"></div><div class="slide" data-slide-title="'+slideName+'"></div><div class="slide"></div>').appendTo( Slider );
			
			// Create items
			var Items = $();
			for( var i=0; i<numberOfItems; i++ ) {
				Items = Items.add( $('<div>',{ 'class':'navitem', text:defaultText+i }) );
			}
			Items.appendTo( Slider );
			
			// Init
			API = Slider[ pluginName ]({
				controlsItems: '.navitem',
				textItem: newText1,
				textCurrentItem: newText2,
				autoplay: false,
			}).data( pluginName );
			
			// Get Buttons
			var ItemsBtns = Slider.find( 'a[role=button][href]' );
			
			
			// ----- Basics
			if( !basicsChecked ) {
				
				// API.settings
				assert.ok(
					(
						API.settings.hasOwnProperty( 'controlsItems' ) &&
						API.settings.hasOwnProperty( 'textItem' ) &&
						API.settings.hasOwnProperty( 'textCurrentItem' )
					),
					'API.settings has controlsItems, textItem and textCurrentItem'
				);
				
				// settings work
				assert.ok(
					(
						ItemsBtns.eq(0).html() === newText2.replace( '{title}', 1 ) &&
						ItemsBtns.eq(1).html() === newText1.replace( '{title}', slideName ) &&
						ItemsBtns.eq(2).html() === newText1.replace( '{title}', 3 )
					),
					'settings work as expected, as well as slides using the data-slide-title attribute'
				);
				basicsChecked = true;
				
				// buttons work
				var current1 = API.data.current;
				API.data.timerChangeF();
				ItemsBtns.eq(2).click();
				var current2 = API.data.current;
				API.data.timerChangeF();
				ItemsBtns.eq(1).click();
				var current3 = API.data.current;
				assert.ok(
					(
						current1 === 0 &&
						current2 === 2 &&
						current3 === 1
					),
					'Buttons change slide on click'
				);
				
				// change class of items
				var correctClasses = true;
				var correctText = true;
				ItemsBtns.each(function(i){
					var btn = $(this);
					var item = btn.parent();
					if( i == API.data.current ) {
						
						if(
							btn.html() !== newText2.replace( '{title}', i+1 ) &&
							btn.html() !== newText2.replace( '{title}', slideName )
						)
							correctText = false;
						if( !item.hasClass( API.settings.classSelected ) )
							correctClasses = false;
						
					} else {
						
						if(
							btn.html() !== newText1.replace( '{title}', i+1 ) &&
							btn.html() !== newText1.replace( '{title}', slideName )
						)
							correctText = false;
						if( item.hasClass( API.settings.classSelected ) )
							correctClasses = false;
						
					}
				});
				assert.ok(
					correctClasses && correctText,
					'items get the correct class name (settings.classSelected), and use the correct text'
				);
				
			}
			
			// --- Recurrent
			assert.ok(
				Slider.find('.navitem:visible').length == Slides.length,
				'Test with '+numberOfItems+': number of visible items always match number of slides'
			);
			assert.ok(
				Slider.find('.navitem:hidden').length == ( Math.max( 0, numberOfItems - Slides.length ) ),
				'Test with '+numberOfItems+': extra items should always be hidden'
			);
			
			
			// Destroy
			API.destroy();
			
			// Count items again
			var ItemsAfter = Slider.find( '.navitem:visible' );
			assert.ok(
				ItemsAfter.length === numberOfItems,
				'Test with '+numberOfItems+': destroy restores original number of items'
			);
			
			// Check text
			var textMatches = true;
			var classMatches = true;
			ItemsAfter.each(function(i){
				if( $(this).html() !== defaultText+i ) {
					textMatches = false;
				}
				if( $(this).hasClass( API.settings.classSelected ) )
					classMatches = false;
			});
			
			assert.ok(
				textMatches && classMatches,
				'Test with '+numberOfItems+': destroy restores original text of items and removes selected class'
			);
			
			// Clean up
			Fixture.empty();
		}
		
		setupTest( 1 );
		setupTest( 3 );
		setupTest( 5 );
	});
	
	// Added restrictNumber as public function
	
	
	
</script>
</body>
</html>